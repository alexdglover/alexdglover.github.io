---

title: 'Arduino Project 1: Heat Seeking Robot (Part 1.5)'
date: 2012-08-22 22:25:25.000000000 -05:00
categories:
- Fun IT Projects
- How-to Guides
tags:
- arduino
- heat seeking robot
- ir thermometer
- motor shield
- robot
- robotics
meta:
  _wpas_done_all: '1'
  jabber_published: '1345692328'
  email_notification: '1345692331'
  reddit: a:2:{s:5:"count";i:0;s:4:"time";i:1346605987;}
  _wpas_skip_twitter: '1'
  _wpas_skip_linkedin: '1'
---
<p>I've procrastinated on this project post far too long! I've had the Heat Seeking Robot working at a <em>very </em> primitive level for over a month now, and posted NOTHING. For this, I am sorry.</p>
<p>So this is Part 1.5, where Part 2 was supposed to be the ultimate conclusion to the project. Here's where we're at so far: we have a working IR Thermometer reporting temperature readings to an Arduino board from <a title="Arduino Project 1: Heat Seeking Robot (Part 1)" href="http://alexdglover.wordpress.com/2012/07/20/arduino-project-1-heat-seeking-robot-part-1/" target="_blank">Part 1</a>. From there, I removed the IR thermometer from the breadboard, and pushed the four pins through one of the servo armatures (the white plus sign shaped object on top of the blue servo). As a throw-away proof-of-concept build, I just used double sided tape to attach the servo to the bread board (this will make more sense later).</p>
<p>[caption id="attachment_116" align="aligncenter" width="600"]<a href="http://alexdglover.files.wordpress.com/2012/08/imag0118.jpg"><img class="size-full wp-image-116" title="Servo and IR Thermometer Mounted on Breadboard" src="{{ site.baseurl }}/assets/imag0118.jpg" alt="Servo and IR Thermometer Mounted on Breadboard" width="600" height="358" /></a> Servo and IR Thermometer Mounted on Breadboard[/caption]</p>
<p>I then pushed the jumper wires into the same servo armatures, originally intending to solder the wires, but it's actually a pretty good connection! I wired up the servo and then combined the IR thermometer sketch with the example sketch 'sweep.' Sweep is a simple servo sketch that makes a servo turn back and forth. Now I could get temperature readings as the thermometer turned back and forth. Not bad so far.</p>
<p><a href="http://29.media.tumblr.com/tumblr_lltzgnHi5F1qzib3wo1_400.jpg"><img class="aligncenter" title="Not Bad" src="{{ site.baseurl }}/assets/tumblr_lltzgnHi5F1qzib3wo1_400.jpg" alt="Not Bad" width="288" height="288" /></a></p>
<p><!--more--></p>
<p>I assembled the Tamiya Tracked Chassis and the double gearbox (with a 37.5x1 gear ratio). The Tamiya chassis kit includes a battery mount for two AA batteries, but I used two 9v batteries instead for space-saving reasons. The battery mount is mounted in the middle of the chassis, which uses up a fair amount of space. By using 2 9v batteries sitting side by side, I got a simple and efficient way to have two mobile power supplies. I also attached some jumper wires to the two motors (two wires per motor, ground and positive; see the white and black wires on the top motor, blue and orange wires on the bottom motor).</p>
<p>[caption id="attachment_115" align="aligncenter" width="600"]<a href="http://alexdglover.files.wordpress.com/2012/08/imag0064.jpg"><img class="size-full wp-image-115" title="Assembled Tamiya Tracked Vehicle Chassis" src="{{ site.baseurl }}/assets/imag0064.jpg" alt="Assembled Tamiya Tracked Vehicle Chassis" width="600" height="358" /></a> Assembled Tamiya Tracked Vehicle Chassis[/caption]</p>
<p>Attached the DF Robot motor shield to the Arduino board. Keep in mind that our connections for the IR thermometer from Part 1 will have to plugged into the corresponding connections on the motor shield. The motor shield transparently connects to the Arduino for all of the analog slots, as well as the 5v, 3v3, and GND connections on the DC connection side of the board (as opposed to the ethernet connection side of the board). Black circuit board is the motor shield, blue board is the Arduino. The pink foam is some packaging foam I got when I ordered these supplies that I use to make sure the board doesn't get shorted when touching the metal battery exterior. May not be necessary, but hey, better safe than sorry.</p>
<p>[caption id="attachment_117" align="aligncenter" width="600"]<a href="http://alexdglover.files.wordpress.com/2012/08/imag0139.jpg"><img class="size-full wp-image-117" title="Arduino and Motor Shield" src="{{ site.baseurl }}/assets/imag0139.jpg" alt="Arduino and Motor Shield" width="600" height="358" /></a> Arduino and Motor Shield[/caption]</p>
<p>As you can see in the above picture, we're using mostly the same pins, just on the motor shield now and not directly on the Arduino. One thing I should have mentioned much much earlier: generally, when you have motors or other devices that consume a fair amount of power (relative to the Arduino), you will want two (or more) separate power sources, one specifically for the Arduino, and separate power sources for the motors. I used one of the male DC plug to 9v battery clips I bought to connect the Arduino and one of the 9v batteries. I used the other 9v battery to power the two DC motors. See the picture below; you'll need to connect your secondary power source (for the motors in this case) to the power-in connections you see on the right. Similarly, each AC motor needs to have a V-in and GND connected to the two green connection blocks in the middle of the picture.</p>
<p>[caption id="attachment_118" align="aligncenter" width="600"]<a href="http://alexdglover.files.wordpress.com/2012/08/imag0123.jpg"><img class="size-full wp-image-118" title="Motor Shield Power and Motor Connections" src="{{ site.baseurl }}/assets/imag0123.jpg" alt="Motor Shield Power and Motor Connections" width="600" height="1003" /></a> Motor Shield Power and Motor Connections[/caption]</p>
<p>Alright, so we've got all of the building blocks in place, let's assemble and see what we've got.</p>
<p>[caption id="attachment_120" align="aligncenter" width="600"]<a href="http://alexdglover.files.wordpress.com/2012/08/imag0141.jpg"><img class="size-full wp-image-120" title="Heat Seeking Robot In Progress" src="{{ site.baseurl }}/assets/imag0141.jpg" alt="Heat Seeking Robot In Progress" width="600" height="358" /></a> Heat Seeking Robot In Progress[/caption]</p>
<p>Alright, so I attached the bread board to the top of the gear box, again by cheating and using double sided tape. The Arduino/motor shield is sitting on top of the two 9v batteries, which I strapped down using a velcro strap (normally used for cable management).</p>
<p>Fast forward through some serious trial and error on writing the application, and voila! We've got... a robot that sort of heat seeks. The idea is simple - the IR thermometer moves back and forth, scanning a room for humans (or anything warmer than 80 degrees fahrenheit). It records the direction of the heat source relative to the direction the robot is facing. The robot should take that direction and adjust until the object is straight ahead of the robot, then drive forward. Heat seeking, at a primitive level.</p>
<p>My robot currently works, except that it has a fixed turn for course correction. In short, if you're 45 degrees left of the robot, the robot will turn left (as intended!) but too far left. So then the target is to the right, and it turns right (as intended!) but too far right. Since it is a static course correction, the robot never lines up perfectly with the target. Getting so close to completing the project took some of the wind out of my sails.  So I hope you enjoyed this as an interim post, and I promise to finish the robot and post the sketch as well. Please comment, or feel free to share your ideas for improvements!</p>
<p>Here's the current (incomplete and very unpolished) version of the sketch:</p>
<blockquote><p><code><br />
// A lot of this code is borrowed from geniuses. I'm crediting all of them up top, as they should be.<br />
// ***<br />
// Sweep<br />
// by BARRAGAN &lt;http://barraganstudio.com&gt;<br />
// This example code is in the public domain.<br />
// ***<br />
// ***<br />
// MLX90614 IR Thermometer code taken from http://bildr.org/2011/02/mlx90614-arduino/<br />
// ***<br />
// Instructions for wiring thermometer here: http://www.arduino.cc/cgi-bin/yabb2/YaBB.pl?num=1214872633<br />
// RGB LED wiring and simple fading sketch: http://wiring.org.co/learning/basics/rgbled.html<br />
// RGB+Arduino Project found here: http://publiclaboratory.org/es/node/593<br />
#include &lt;Servo.h&gt;<br />
#include &lt;i2cmaster.h&gt;<br />
#include &lt;AFMotor.h&gt;</code></p>
<p>AF_DCMotor rMotor(3); // for M2 on Adafruit Motor Shield - not sure why<br />
AF_DCMotor lMotor(4); // for M1 on Adafruit Motor Shield - not sure why</p>
<p>Servo myservo; // create servo object to control a servo</p>
<p>int pos = 0; // variable to store the servo position</p>
<p>int courseChange = 0; // variable to hold the value of how much of a course correction is needed - always less than 90</p>
<p>// set your thresholds for temperatures here - PROBABLY WON'T NEED ALL OF THESE IN MY APPLICATION<br />
int cold = 60;<br />
int normal = 80;<br />
int hot = 100;</p>
<p>String tempLabel = " degrees F";</p>
<p>void setup()<br />
{<br />
myservo.attach(7); // attaches the servo on pin 9 to the servo object</p>
<p>// turn on motors<br />
//lMotor.setSpeed(100);<br />
lMotor.run(RELEASE);<br />
//rMotor.setSpeed(100);<br />
rMotor.run(RELEASE);</p>
<p>Serial.begin(9600); // Begin serial output at 9600 BAUD<br />
Serial.println("Setup..."); // Print a quick note to terminal</p>
<p>i2c_init(); //Initialise the i2c bus<br />
PORTC = (1 &lt;&lt; PORTC4) | (1 &lt;&lt; PORTC5);//enable pullups<br />
}</p>
<p>void loop()<br />
{<br />
int highestTemp = 0; // integer to hold the value of the highest temperature reading so far - will be<br />
int pointOfInterestCount = 0; //integer to hold the value of points of intersest; will divide total heading to get average heading<br />
int pointOfInterest = 0; // integer, between 0 and 180, to indicate which direction the 'point of interest' is<br />
int totalPointOfInterest = 0; //incremented integer that is a sum of all headings; will be divided to get average heading</p>
<p>for(pos = 10; pos &lt; 180; pos += 1) // goes from 0 degrees to 180 degrees in steps of 1 degree<br />
{<br />
// Insane IR Thermometer handling code - I do not pretend to understand this code.<br />
int dev = 0x5A&lt;&lt;1;<br />
int data_low = 0;<br />
int data_high = 0;<br />
int pec = 0;</p>
<p>i2c_start_wait(dev+I2C_WRITE);<br />
i2c_write(0x07);<br />
// END Insane IR Thermometer handling code</p>
<p>myservo.write(pos); // tell servo to go to position in variable 'pos'</p>
<p>// IR Thermometer takes a reading<br />
i2c_rep_start(dev+I2C_READ);<br />
data_low = i2c_readAck(); //Read 1 byte and then send ack<br />
data_high = i2c_readAck(); //Read 1 byte and then send ack<br />
pec = i2c_readNak();<br />
i2c_stop();</p>
<p>//This converts high and low bytes together and processes temperature, MSB is a error bit and is ignored for temps<br />
double tempFactor = 0.02; // 0.02 degrees per LSB (measurement resolution of the MLX90614)<br />
double tempData = 0x0000; // zero out the data<br />
int frac; // data past the decimal point</p>
<p>// This masks off the error bit of the high byte, then moves it left 8 bits and adds the low byte.<br />
tempData = (double)(((data_high &amp; 0x007F) &lt;&lt; 8) + data_low); tempData = (tempData * tempFactor)-0.01; float celcius = tempData - 273.15; float fahrenheit = (celcius*1.8) + 32; if(fahrenheit &gt; normal){ // If the IR thermometer gets a reading greater than 60F<br />
//Serial.println("above 80F"); // print to console for reference<br />
if(fahrenheit &gt; (highestTemp+1)){ // If the IR thermometer gets a reading that is the highest reading so far<br />
//Serial.println("above 80F and the new highestTemp at"); // print to console for reference<br />
highestTemp = fahrenheit; // Set the 'highestTemp' variable to the new temperature<br />
pointOfInterest = pos; // Record the 'heading' that the servo is currently pointing<br />
//Serial.println(pointOfInterest);<br />
//Serial.println("degrees");<br />
}<br />
}<br />
else if (fahrenheit &lt;= cold){<br />
Serial.println("below 60F"); // print to console for reference<br />
}</p>
<p>delay(5); // waits 50ms for the servo to reach the position and for the IR thermometer to get a good reading<br />
}<br />
Serial.println(highestTemp + tempLabel);<br />
Serial.println(pointOfInterest);<br />
uint8_t i;<br />
courseChange = 0;<br />
if((pointOfInterest &lt; 80)&amp;&amp;(pointOfInterest != 0)){ /*courseChange = 90 - pointOfInterest; i = courseChange;*/ rMotor.run(FORWARD); Serial.println("to the left"); rMotor.setSpeed(255); delay(1000); rMotor.setSpeed(0); } else if(pointOfInterest &gt; 100){<br />
/*courseChange = 90 - pointOfInterest;<br />
i = courseChange;*/<br />
lMotor.run(FORWARD);<br />
Serial.println("to the right");<br />
lMotor.setSpeed(255);<br />
delay(1000);<br />
lMotor.setSpeed(0);<br />
}<br />
else if((pointOfInterest &gt;= 80)&amp;&amp;(pointOfInterest&lt;=100)){ lMotor.run(FORWARD); rMotor.run(FORWARD); Serial.println("straight ahead"); lMotor.setSpeed(255); rMotor.setSpeed(255); delay(2000); lMotor.setSpeed(0); rMotor.setSpeed(0); /*digitalWrite(4,HIGH); digitalWrite(7, HIGH); analogWrite(5, 255); //PWM Speed Control analogWrite(6, 255); //PWM Speed Control delay(2000); analogWrite(5, 0); //PWM Speed Control analogWrite(6, 0); //PWM Speed Control */ } else if(pointOfInterest == 0){ Serial.println("No target - turning 90 degrees left"); rMotor.run(FORWARD); rMotor.setSpeed(255); delay(1000); rMotor.setSpeed(0); } delay(1000); for(pos = 180; pos&gt;=10; pos-=1) // goes from 180 degrees to 0 degrees in steps of 1 degree<br />
{<br />
// Insane IR Thermometer handling code - I do not pretend to understand this code.<br />
int dev = 0x5A&lt;&lt;1;<br />
int data_low = 0;<br />
int data_high = 0;<br />
int pec = 0;</p>
<p>i2c_start_wait(dev+I2C_WRITE);<br />
i2c_write(0x07);<br />
// END Insane IR Thermometer handling code</p>
<p>myservo.write(pos); // tell servo to go to position in variable 'pos'</p>
<p>// IR Thermometer takes a reading<br />
i2c_rep_start(dev+I2C_READ);<br />
data_low = i2c_readAck(); //Read 1 byte and then send ack<br />
data_high = i2c_readAck(); //Read 1 byte and then send ack<br />
pec = i2c_readNak();<br />
i2c_stop();</p>
<p>//This converts high and low bytes together and processes temperature, MSB is a error bit and is ignored for temps<br />
double tempFactor = 0.02; // 0.02 degrees per LSB (measurement resolution of the MLX90614)<br />
double tempData = 0x0000; // zero out the data<br />
int frac; // data past the decimal point</p>
<p>// This masks off the error bit of the high byte, then moves it left 8 bits and adds the low byte.<br />
tempData = (double)(((data_high &amp; 0x007F) &lt;&lt; 8) + data_low); tempData = (tempData * tempFactor)-0.01; float celcius = tempData - 273.15; float fahrenheit = (celcius*1.8) + 32; if(fahrenheit &gt; normal){ // If the IR thermometer gets a reading greater than 60F<br />
//Serial.println("above 80F"); // print to console for reference<br />
if(fahrenheit &gt; (highestTemp+1)){ // If the IR thermometer gets a reading that is the highest reading so far<br />
//Serial.println("above 80F and the new highestTemp at"); // print to console for reference<br />
highestTemp = fahrenheit; // Set the 'highestTemp' variable to the new temperature<br />
pointOfInterest = pos; // Record the 'heading' that the servo is currently pointing<br />
//Serial.println(pointOfInterest);<br />
//Serial.println("degrees");<br />
}<br />
}<br />
else if (fahrenheit &lt;= cold){<br />
Serial.println("below 60F"); // print to console for reference<br />
}<br />
delay(5); // waits 50ms for the servo to reach the position and for the IR thermometer to get a good reading<br />
}<br />
Serial.println(highestTemp + tempLabel);<br />
Serial.println(pointOfInterest);<br />
i = 0;<br />
courseChange = 0;<br />
if((pointOfInterest &lt; 80)&amp;&amp;(pointOfInterest != 0)){ /*courseChange = 90 - pointOfInterest; i = courseChange;*/ rMotor.run(FORWARD); Serial.println("to the left"); rMotor.setSpeed(255); delay(1000); rMotor.setSpeed(0); } else if(pointOfInterest &gt; 100){<br />
/*courseChange = 90 - pointOfInterest;<br />
i = courseChange;*/<br />
lMotor.run(FORWARD);<br />
Serial.println("to the right");<br />
lMotor.setSpeed(255);<br />
delay(1000);<br />
lMotor.setSpeed(0);<br />
}<br />
else if((pointOfInterest &gt;= 80)&amp;&amp;(pointOfInterest&lt;=100)){<br />
lMotor.run(FORWARD);<br />
rMotor.run(FORWARD);<br />
Serial.println("straight ahead");<br />
lMotor.setSpeed(255);<br />
rMotor.setSpeed(255);<br />
delay(2000);<br />
lMotor.setSpeed(0);<br />
rMotor.setSpeed(0);<br />
/*digitalWrite(4,LOW);<br />
digitalWrite(7, LOW);<br />
analogWrite(5, 255); //PWM Speed Control<br />
analogWrite(6, 255); //PWM Speed Control<br />
delay(2000);<br />
analogWrite(5, 0); //PWM Speed Control<br />
analogWrite(6, 0); //PWM Speed Control */<br />
}<br />
else if(pointOfInterest == 0){<br />
Serial.println("No target - turning 90 degrees left");<br />
rMotor.run(FORWARD);<br />
rMotor.setSpeed(255);<br />
delay(1000);<br />
rMotor.setSpeed(0);<br />
}<br />
delay(1000);</p>
<p>}</p></blockquote>
