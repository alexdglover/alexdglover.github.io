I"±<p>Alright, if you're following along from Part 1, you should have your headphones/speakers as well as your ultrasonic rangefinder wired up and operational. Next we have to write the code to marry these two devices.</p>
<h3>The Code</h3>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
Alex Glover
Copyright December 2012
The Audible Eye - handheld device that utilizes an ultrasonic rangefinder to determine distance to whatever object the device is pointed at.
Feedback will be delivered to operator via sound - tone will increase pitch for shorter distances, no tones played for extreme distances.

Credit to:
YourDuino SKETCH UltraSonic Serial 1.0
terry@yourduino.com

Uses: Ultrasonic Library (Copy to Arduino Library folder)
http://iteadstudio.com/store/images/produce/Sensor/HCSR04/Ultrasonic.rar
*/</span>

<span class="cm">/* Libraries */</span>
<span class="cp">#include "Ultrasonic.h"
</span><span class="cm">/* Pin Assignments */</span>
<span class="c1">//Pin designated for controlling the emission of ultrasonic 'pings'</span>
<span class="cp">#define TRIG_PIN 2
</span><span class="c1">//Pin designated to 'listen' for ultrasonic 'pings'</span>
<span class="cp">#define ECHO_PIN 7
</span><span class="c1">//Pin used to drive the audio output through the headphones</span>
<span class="cp">#define SOUND_PIN 12
</span><span class="cm">/* Declare objects */</span>
<span class="c1">//Create an object of type 'Ultrasonic' and call it 'Sensor,' passing the trig pin and echo pin numbers into the constructor</span>
<span class="n">Ultrasonic</span> <span class="nf">Sensor</span><span class="p">(</span><span class="n">TRIG_PIN</span><span class="p">,</span> <span class="n">ECHO_PIN</span><span class="p">);</span>
<span class="cm">/*-----( Declare Variables )-----*/</span>
<span class="c1">//Variable to hold the tone value; this value will be calculated first, and then passed to the tone() function</span>
<span class="kt">int</span> <span class="n">toneToPlay</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="c1">//Pring the following text to the serial monitor</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"The Audible Eye"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"alexdglover.wordpress.com alexdglover@gmail.com"</span><span class="p">);</span>

<span class="p">}</span>
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">//20 millisend delay to let echos from room dissipate</span>

  <span class="c1">//The sensor occasionally returns 0 incorrectly. 0 would also give us a divide by zero error in the next line of code. To address these issues</span>
  <span class="c1">//we use this simple if statement. Basically, if a 0 is returned, we play no tones through the headphones.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">Sensor</span><span class="p">.</span><span class="n">Ranging</span><span class="p">(</span><span class="n">INC</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">){</span>
    <span class="c1">//Calculating the tone to play as 1000 hertz divided by the number of inches. So if the device is one inch away from an obstacle, we play</span>
    <span class="c1">//a 1000 hertz tone. If the device is 10 inches away, it plays a 100 hertz tone. Anything greater than 20 inches reduces the tone to almost inaudible.</span>
    <span class="n">toneToPlay</span><span class="o">=</span><span class="p">(</span><span class="mi">1000</span><span class="o">/</span><span class="n">Sensor</span><span class="p">.</span><span class="n">Ranging</span><span class="p">(</span><span class="n">INC</span><span class="p">));</span>
  <span class="p">}</span>
  <span class="k">else</span><span class="p">{</span>
    <span class="n">toneToPlay</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="c1">//Here we take whatever value toneToPlay was calculated at and pass it into the tone() function. The parameter of 200 is the number of milliseconds to play</span>
  <span class="c1">//the tone. The loop takes about 200 milliseconds in total, so if the loop hangs or crashes, the tone won't keep getting played indefinitely.</span>
  <span class="n">tone</span><span class="p">(</span><span class="n">SOUND_PIN</span><span class="p">,</span><span class="n">toneToPlay</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Upload that sketch to your Arduino and test. If all's well, you should be hearing various tones coming out of your headphones depending on what's in front of your rangefinder.</p>
<h3>The Finishing Touches</h3>
<p>Now at this point, you could declare this project a success. The device works as intended. However, I wanted to give this project a few finishing touches that I usually skip over, so let's put it all inside an enclosure, make it portable (i.e. battery powered), and throw on a badass toggle switch for the fun of it.</p>
<p>First, let's wire up the toggle switch. Take one of your 9V battery adapters and cut both wires about halfway between the battery clip and the male adapter. Now take the battery clip side and strip the wires. Connect the red wire to the voltage-in connection on the switch and the black wire to the ground.Â Now take the male adapter piece and strip the wires. Connect the red wire to the voltage-out connection on the switch and connect the black wire to the same ground connection on the switch we used before. My wiring is quite ugly, but you should get something that looks like this:</p>
<p style="text-align: center;"><a href="https://www.alexdglover.com/assets/imag0369.jpg"><img class="aligncenter size-full wp-image-330" alt="alexdglover_audible_eye_toggle_switch" src="/assets/imag0369.jpg" width="595" height="355" /></a></p>
<p>Now for the enclosure. I was having a hard time finding a legitimate project enclosure of the right size, so I just used an old cardboard box. Cut out a small rectangle for the the rangefinder to protrude from at the front of your device. On a different side, cut out another hole (size will depend on what size of toggle switch you use). Once you have your holes cut, start installing your components. For my enclosure, I installed everything but the Arduino on one 'level' and used some packingÂ foam to wedge things into place.</p>
<p style="text-align: center;"><a href="https://www.alexdglover.com/assets/imag0367.jpg"><img class="aligncenter size-full wp-image-333" alt="alexdglover_audible_eye_enclosure" src="/assets/imag0367.jpg" width="595" height="355" /></a></p>
<p>Then I installed the Arduino and connected the power adapter, leaving the headphones outside of the box as I closed the lid. Here's a final closeup:</p>
<p style="text-align: center;"><a href="https://www.alexdglover.com/assets/imag0361.jpg"><img class="aligncenter size-full wp-image-312" alt="alexdglover_audible_eye" src="/assets/imag0361.jpg" width="595" height="355" /></a></p>
<p>That's it, hope you enjoyed the post!</p>
:ET